@model Web.Models.RegisterClientViewModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crear cuenta (Cliente) - MechaGestionEX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        html, body {
            height: 100%;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 40px;
            padding-bottom: 40px;
            background-color: var(--bs-body-bg);
        }

        .form-register {
            max-width: 720px;
            width: 100%;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <main class="form-register">
        <div class="card rounded-4 shadow">
            <div class="card-body p-4 p-md-5">
                <div class="text-center pb-3 border-bottom">
                    <h1 class="fw-bold fs-3 mb-1">Crear cuenta (Cliente)</h1>
                    <p class="text-secondary mb-0">Completa tus datos para registrarte</p>
                </div>

                <form asp-controller="Account" asp-action="RegisterClient" method="post" class="pt-3">
                    @Html.AntiForgeryToken()

                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <div class="row g-3">
                        <!-- Cuenta -->
                        <div class="col-12">
                            <h5 class="mb-2">Datos de la cuenta</h5>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="NombreUsuario" class="form-control" placeholder="usuario" />
                                <label asp-for="NombreUsuario"></label>
                            </div>
                            <span asp-validation-for="NombreUsuario" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Correo" class="form-control" placeholder="correo@ejemplo.com" />
                                <label asp-for="Correo"></label>
                            </div>
                            <span asp-validation-for="Correo" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Password" class="form-control" placeholder="Contraseña" />
                                <label asp-for="Password"></label>
                            </div>
                            <span asp-validation-for="Password" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="ConfirmPassword" class="form-control" placeholder="Confirmar contraseña" />
                                <label asp-for="ConfirmPassword"></label>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                        </div>

                        <!-- Cliente -->
                        <div class="col-12">
                            <h5 class="mt-3 mb-2">Datos del cliente</h5>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Rut" class="form-control" placeholder="12.345.678-9" />
                                <label asp-for="Rut"></label>
                            </div>
                            <span asp-validation-for="Rut" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Nombre" class="form-control" placeholder="Nombre y Apellido" />
                                <label asp-for="Nombre"></label>
                            </div>
                            <span asp-validation-for="Nombre" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Telefono" class="form-control" placeholder="Teléfono" />
                                <label asp-for="Telefono"></label>
                            </div>
                            <span asp-validation-for="Telefono" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input asp-for="Direccion" class="form-control" placeholder="Dirección" />
                                <label asp-for="Direccion"></label>
                            </div>
                            <span asp-validation-for="Direccion" class="text-danger small"></span>
                        </div>

                        <div class="col-md-6">
                            <label for="regionSelect" class="form-label">Región</label>
                            <select id="regionSelect" class="form-select" name="RegionId">
                                <option value="">Seleccione una región</option>
                                @if (ViewBag.Regions != null)
                                {
                                    foreach (var r in ViewBag.Regions)
                                    {
                                        <option value="@r.id">@r.nombre</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="ComunaId" class="form-label">Comuna</label>
                            <select asp-for="ComunaId" id="comunaSelect" class="form-select" disabled>
                                <option value="">Seleccione una comuna</option>
                            </select>
                            <span asp-validation-for="ComunaId" class="text-danger small"></span>
                        </div>

                    </div>

                    <div class="d-grid d-md-flex gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg rounded-3">
                            Crear cuenta
                        </button>
                        <a asp-controller="Account" asp-action="Login" class="btn btn-outline-secondary btn-lg rounded-3">
                            Volver al inicio de sesión
                        </a>
                    </div>
                </form>

                @* Si usas validación cliente unobtrusive, puedes incluir tu partial:
               @await Html.PartialAsync("_ValidationScriptsPartial")
               (Lo dejamos para cuando confirmes si usas ese partial) *@
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const regionSelect = document.getElementById('regionSelect');
            const comunaSelect  = document.getElementById('comunaSelect');

            regionSelect.addEventListener('change', async function () {
                const regionId = this.value;

                // Limpiar comunas
                comunaSelect.innerHTML = '<option value="">Seleccione una comuna</option>';
                comunaSelect.disabled = true;

                if (!regionId) return;

                try {
                    const resp = await fetch(`/Account/ComunasPorRegion/${regionId}`);
                    if (!resp.ok) throw new Error('Error al cargar comunas');
                    const data = await resp.json();

                    for (const c of data) {
                        const opt = document.createElement('option');
                        opt.value = c.id;
                        opt.textContent = c.nombre;
                        comunaSelect.appendChild(opt);
                    }
                    comunaSelect.disabled = data.length === 0;
                } catch (err) {
                    console.error(err);
                    comunaSelect.disabled = true;
                }
            });
        });
    </script>

</body>
</html>
